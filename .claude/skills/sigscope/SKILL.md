---
name: sigscope
description: VCD波形デバッグツール。SystemVerilogシミュレーションのデバッグ支援。Use when the user requests debugging of VCD files, waveform analysis, signal verification, or troubleshooting timing/protocol issues. Triggered by requests like "デバッグして", "確認して", "この信号がおかしい", "波形を見て", or when working with .vcd files.
---

# Sigscope - VCD波形デバッグ

VCDファイルから波形データを抽出して解析し、タイミング異常や不定値などの問題を特定する。

## デバッグワークフロー

### 1. VCDファイルの確認

まず`sigscope list`で利用可能な信号を確認:

```bash
sigscope list <vcd-file>
```

出力から:
- 全信号のリスト
- タイムスケール（1ps, 1nsなど）
- 時間範囲

### 2. 関連信号の抽出

問題が発生している範囲と信号を特定して`sigscope query`で抽出:

```bash
# 特定信号のみ
sigscope query -s <signal-pattern> <vcd-file>

# 時間範囲指定
sigscope query -s <signal-pattern> -t <start> -e <end> <vcd-file>
```

**出力形式:**
- `init`: 初期値
- `events`: 時刻順の変化イベント（変化した信号のみ）
- `clock`: 自動検出されたクロック情報
- `defs`: 信号定義（ビット幅、基数）

### 3. 問題の特定

抽出した波形データから以下をチェック:

#### タイミング異常
- セットアップ/ホールドタイム違反
- 予期しないタイミングでの信号変化
- クロックエッジとの相対的タイミング

#### 不定値（x）・高インピーダンス（z）
- 初期化されていない信号
- 競合状態
- 未接続端子

#### 状態遷移の問題
- 不正な状態遷移
- 状態の滞留
- 遷移条件の不一致

#### プロトコル違反
- ハンドシェイク信号のタイミング
- データバスの有効期間
- フレーム構造の異常

### 4. 問題の報告

検出した問題を以下の形式で報告:

- **問題の種類**: タイミング/不定値/状態遷移/プロトコル
- **発生時刻**: タイムスケール単位
- **関連信号**: 問題に関わる信号名
- **期待値vs実際の値**: 何が期待されていたか
- **原因の推測**: 可能であれば根本原因

## 典型的な問題パターン

### リセット不完全
- `rst_n`が立ち上がった後も信号がx
- 初期化ロジックの不足

### セットアップ/ホールド違反
- クロックエッジ直前/直後でのデータ変化
- クロック周期との比較

### プロトコル不一致
- valid信号なしでのデータ変化
- ハンドシェイク信号の順序違反
- パケット長の不整合

### デッドロック
- 特定状態で信号が変化しない
- ハンドシェイク信号の待機状態

## コマンドリファレンス

詳細なコマンドオプションと出力形式は [sigscope-guide.md](references/sigscope-guide.md) を参照。

## 注意事項

- 信号名は階層の最後の要素に短縮される（衝突の可能性）
- クロック信号は`events`から除外される
- 出力はコンパクトJSON（改行なし）
- 大規模VCDは処理時間がかかる
